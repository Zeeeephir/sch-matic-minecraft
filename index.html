<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi de Matériaux Minecraft</title>
    <!-- Tailwind CSS pour un style moderne et responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Définir la police pour un look cohérent */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 p-8">
    <div class="container mx-auto">
        <h1 class="text-4xl font-bold mb-6 text-center text-teal-400">Suivi de Matériaux Minecraft</h1>
        
        <!-- Section de téléversement de fichier -->
        <div class="mb-8 p-6 bg-gray-800 rounded-xl shadow-lg border border-gray-700">
            <h2 class="text-2xl font-semibold mb-4 text-teal-300">Importer votre liste</h2>
            <label for="file-input" class="block mb-2 text-lg">Choisissez votre fichier .txt :</label>
            <input 
                type="file" 
                id="file-input" 
                accept=".txt" 
                class="block w-full text-sm text-gray-400
                  file:mr-4 file:py-2 file:px-4
                  file:rounded-full file:border-0
                  file:text-sm file:font-semibold
                  file:bg-teal-50 file:text-teal-700
                  hover:file:bg-teal-100"
            />
            <p id="error-message" class="mt-4 text-red-400 hidden">
              Le fichier n'a pas pu être traité. Assurez-vous qu'il a le bon format.
            </p>
            <button 
                id="reset-button" 
                class="mt-4 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 transition-colors"
            >
                Réinitialiser
            </button>
        </div>

        <!-- Conteneur pour le tableau des matériaux -->
        <div id="materials-container"></div>
    </div>

    <script>
        // Le fichier d'exemple pour l'initialisation de l'application
        const sampleMaterialList = `+-------------------------------+-------+---------+------------------------------------+
| Material List for placement 'giant_floating_tree_house9874050 (Converted Schematic)' |
+-------------------------------+-------+---------+------------------------------------+
| Item                          | Total | Missing |                          Available |
+-------------------------------+-------+---------+------------------------------------+
| Oak Leaves                    | 21329 |   21329 |                                  0 |
| Stone                         | 14748 |   14748 |                                  0 |
| Dark Oak Planks               |  6212 |    6212 |                                  0 |
| Birch Planks                  |  5873 |    5873 |                                  0 |
| Dirt                          |  4053 |    4053 |                                  0 |
| Oak Log                       |  3682 |    3682 |                                  0 |
| Oak Fence                     |  2516 |    2516 |                                  0 |
| Grass Block                   |  2011 |    2009 |                                  0 |
| White Stained Glass Pane      |  1954 |   1954 |                                  0 |
| Glowstone                     |  1890 |    1890 |                                  0 |
| Oak Planks                    |  1888 |    1886 |                                  0 |
| Dark Oak Slab                 |  1736 |    1736 |                                  0 |
| Torch                         |  1516 |    1516 |                                  0 |
| Birch Stairs                  |  1348 |    1348 |                                  0 |
| White Stained Glass           |  1302 |    1302 |                                  0 |
| White Carpet                  |  1203 |    1203 |                                  0 |
| Bookshelf                     |  1161 |    1161 |                                  0 |
| Redstone Dust                 |   921 |     921 |                                  0 |
| Red Carpet                    |   867 |     867 |                                  0 |
| White Wool                    |   727 |     727 |                                  0 |
| Red Wool                      |   675 |     675 |                                  0 |
| Chiseled Quartz Block         |   655 |     655 |                                  0 |
| Glass                         |   632 |     632 |                                  0 |
| Jungle Leaves                 |   619 |     619 |                                  0 |
| Birch Slab                    |   602 |     602 |                                  0 |
| Black Wool                    |   595 |     595 |                                  0 |
| Lime Stained Glass            |   489 |     489 |                                  0 |
| Yellow Terracotta             |   474 |     474 |                                  0 |
| Block of Quartz               |   444 |     444 |                                  0 |
| Redstone Repeater             |   347 |     347 |                                  0 |
| Black Terracotta              |   298 |     298 |                                  0 |
| Quartz Slab                   |   286 |     286 |                                  0 |
| Water Bucket                  |   268 |     268 |                                  0 |
| Birch Leaves                  |   214 |     214 |                                  0 |
| Ladder                        |   209 |     209 |                                  0 |
| Acacia Planks                 |   206 |     206 |                                  0 |
| Sticky Piston                 |   205 |     205 |                                  0 |
| Block of Gold                 |   192 |     192 |                                  0 |
| Redstone Torch                |   180 |     180 |                                  0 |
| Blue Stained Glass            |   166 |     166 |                                  0 |
| Chest                         |   155 |     155 |                                  0 |
| Gravel                        |   106 |     106 |                                  0 |
| Flower Pot                    |    99 |      99 |                                  0 |
| Black Stained Glass           |    88 |      88 |                                  0 |
| Oak Stairs                    |    78 |      78 |                                  0 |
| Sea Lantern                   |    77 |      77 |                                  0 |
| Hopper                        |    68 |      68 |                                  0 |
| Brown Carpet                  |    64 |      64 |                                  0 |
| Oak Slab                      |    63 |      63 |                                  0 |
| Block of Emerald              |    62 |      62 |                                  0 |
| Cyan Carpet                   |    56 |      56 |                                  0 |
| Green Carpet                    |    56 |      56 |                                  0 |
| Block of Lapis Lazuli         |    54 |      54 |                                  0 |
| Note Block                    |    54 |      54 |                                  0 |
| Quartz Stairs                 |    47 |      47 |                                  0 |
| Block of Diamond              |    46 |      46 |                                  0 |
| Diamond Ore                   |    46 |      46 |                                  0 |
| Wheat Seeds                   |    45 |      45 |                                  0 |
| Obsidian                      |    43 |      43 |                                  0 |
| Red Terracotta                |    39 |      39 |                                  0 |
| Cyan Stained Glass            |    37 |      37 |                                  0 |
| Blue Orchid                   |    36 |      36 |                                  0 |
| Furnace                       |    35 |      35 |                                  0 |
| Redstone Lamp                 |    34 |      34 |                                  0 |
| Birch Log                     |    33 |      33 |                                  0 |
| White Banner                  |    32 |      32 |                                  0 |
| Dispenser                     |    31 |      31 |                                  0 |
| Red Stained Glass             |    31 |      31 |                                  0 |
| Potato                        |    30 |      30 |                                  0 |
| Quartz Pillar                 |    30 |      30 |                                  0 |
| Dandelion                     |    28 |      28 |                                  0 |
| Packed Ice                    |    28 |      28 |                                  0 |
| Slime Block                   |    25 |      25 |                                  0 |
| Stone Slab                    |    25 |      25 |                                  0 |
| Red Banner                    |    24 |      24 |                                  0 |
| Redstone Comparator           |    24 |      24 |                                  0 |
| Acacia Stairs                 |    22 |      22 |                                  0 |
| Dark Oak Stairs               |    20 |      20 |                                  0 |
| Red Bed                       |    20 |      20 |                                  0 |
| Lever                         |    17 |      17 |                                  0 |
| Stone Button                  |    17 |      17 |                                  0 |
| Dropper                       |    16 |      16 |                                  0 |
| Trapped Chest                 |    16 |      16 |                                  0 |
| Oak Button                    |    15 |      15 |                                  0 |
| Oak Trapdoor                  |    15 |      15 |                                  0 |
| Allium                        |    14 |      14 |                                  0 |
| Crafting Table                |    14 |      14 |                                  0 |
| Heavy Weighted Pressure Plate |    14 |      14 |                                  0 |
| Azure Bluet                   |    13 |      13 |                                  0 |
| Block of Redstone             |    13 |      13 |                                  0 |
| Lime Carpet                   |    13 |      13 |                                  0 |
| Oak Pressure Plate            |    13 |      13 |                                  0 |
| Piston                        |    13 |      13 |                                  0 |
| Tall Grass                    |    13 |      13 |                                  0 |
| Jukebox                       |    12 |      12 |                                  0 |
| Jungle Log                    |    11 |      11 |                                  0 |
| Poppy                         |    11 |      11 |                                  0 |
| Birch Door                    |     9 |       9 |                                  0 |
| Brown Stained Glass           |     9 |       9 |                                  0 |
| Brown Wool                    |     8 |       8 |                                  0 |
| Coarse Dirt                   |     8 |       8 |                                  0 |
| Iron Door                     |     8 |       8 |                                  0 |
| Pink Tulip                    |     8 |       8 |                                  0 |
| Brewing Stand                 |     7 |       7 |                                  0 |
| Green Terracotta              |     7 |       7 |                                  0 |
| Oxeye Daisy                   |     7 |       7 |                                  0 |
| Blue Carpet                   |     6 |       6 |                                  0 |
| Cobweb                        |     6 |       6 |                                  0 |
| Cyan Terracotta               |     6 |       6 |                                  0 |
| Enchanting Table              |     6 |       6 |                                  0 |
| Ender Chest                   |     6 |       6 |                                  0 |
| Snow                          |     6 |       6 |                                  0 |
| Sugar Cane                    |     6 |       6 |                                  0 |
| Cauldron                      |     5 |       5 |                                  0 |
| Sand                          |     5 |       5 |                                  0 |
| Acacia Log                    |     4 |       4 |                                  0 |
| Birch Fence                   |     4 |       4 |                                  0 |
| Carved Pumpkin                |     4 |       4 |                                  0 |
| Cyan Banner                   |     4 |       4 |                                  0 |
| Dark Oak Fence                |     4 |       4 |                                  0 |
| Dark Oak Fence Gate           |     4 |       4 |                                  0 |
| Dark Oak Log                  |     4 |       4 |                                  0 |
| Light Blue Stained Glass      |     4 |       4 |                                  0 |
| Light Weighted Pressure Plate |     4 |       4 |                                  0 |
| Oak Fence Gate                |     4 |       4 |                                  0 |
| Orange Tulip                  |     4 |       4 |                                  0 |
| Red Tulip                     |     4 |       4 |                                  0 |
| Stone Pressure Plate          |     4 |       4 |                                  0 |
| White Tulip                   |     4 |       4 |                                  0 |
| Beacon                        |     3 |       3 |                                  0 |
| Blue Banner                   |     3 |       3 |                                  0 |
| Brown Terracotta              |     3 |       3 |                                  0 |
| Dark Oak Door                 |     3 |       3 |                                  0 |
| Melon Seeds                   |     3 |       3 |                                  0 |
| Pumpkin Seeds                 |     3 |       3 |                                  0 |
| End Portal Frame              |     2 |       2 |                                  0 |
| Glass Pane                    |     2 |       2 |                                  0 |
| Light Blue Banner             |     2 |       2 |                                  0 |
| Melon                         |     2 |       2 |                                  0 |
| Rose Bush                     |     2 |       2 |                                  0 |
| Acacia Sapling                |     1 |       1 |                                  0 |
| Anvil                         |     1 |       1 |                                  0 |
| Birch Sapling                 |     1 |       1 |                                  0 |
| Black Carpet                  |     1 |       1 |                                  0 |
| Block of Iron                 |     1 |       1 |                                  0 |
| Blue Terracotta               |     1 |       1 |                                  0 |
| Cactus                        |     1 |       1 |                                  0 |
| Cake                          |     1 |       1 |                                  0 |
| Dark Oak Sapling              |     1 |       1 |                                  0 |
| Daylight Detector             |     1 |       1 |                                  0 |
| Gray Carpet                   |     1 |       1 |                                  0 |
| Jungle Sapling                |     1 |       1 |                                  0 |
| Light Blue Terracotta         |     1 |       1 |                                  0 |
| Light Gray Terracotta         |     1 |       1 |                                  0 |
| Lilac                         |     1 |       1 |                                  0 |
| Lime Terracotta               |     1 |       1 |                                  0 |
| Lime Wool                     |     1 |       1 |                                  0 |
| Magenta Terracotta            |     1 |       1 |                                  0 |
| Orange Terracotta             |     1 |       1 |                                  0 |
| Pink Terracotta               |     1 |       1 |                                  0 |
| Powered Rail                  |     1 |       1 |                                  0 |
| Purple Terracotta             |     1 |       1 |                                  0 |
| Spruce Sapling                |     1 |       1 |                                  0 |
| Sunflower                     |     1 |       1 |                                  0 |
+-------------------------------+-------+---------+------------------------------------+
| Item                          | Total | Missing |                          Available |
+-------------------------------+-------+---------+------------------------------------+`;

        // Fonction pour parser le fichier .txt de manière plus robuste
        const parseMaterialList = (text) => {
            const lines = text.split(/\r?\n/);
            const materials = [];
            let startParsing = false;

            for (const line of lines) {
                const trimmedLine = line.trim();
                
                // On détecte les lignes de début et de fin de tableau
                if (trimmedLine.includes('+-------------------------------+-------+---------+------------------------------------+')) {
                    startParsing = !startParsing;
                    // On s'arrête si on a fini de parser un tableau non-vide
                    if (!startParsing && materials.length > 0) { 
                        break; 
                    }
                    continue;
                }
                
                // On parse les lignes de données uniquement à l'intérieur du tableau
                if (startParsing) {
                    const parts = trimmedLine.split('|').map(p => p.trim());
                    // Une ligne de données valide doit avoir au moins 5 parties et ne pas être une ligne d'en-tête
                    if (parts.length >= 5 && parts[0] === '' && !parts[1].includes('Item')) {
                        const item = parts[1];
                        const total = parseInt(parts[2], 10);
                        // On s'assure que la valeur est un nombre valide
                        if (!isNaN(total)) {
                            materials.push({
                                item: item,
                                total: total,
                                have: 0
                            });
                        }
                    }
                }
            }
            return materials;
        };

        // Fonction pour générer le tableau et gérer les événements
        const renderMaterials = (materials) => {
            const container = document.getElementById('materials-container');
            container.innerHTML = ''; // Nettoyer le conteneur

            if (materials.length === 0) {
                return;
            }

            const tableHtml = `
                <div class="bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-700">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Objet
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Total nécessaire
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Possédé
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                                    Statut
                                </th>
                            </tr>
                        </thead>
                        <tbody id="materials-table-body" class="bg-gray-800 divide-y divide-gray-700">
                        </tbody>
                    </table>
                </div>
            `;
            container.innerHTML = tableHtml;
            const tableBody = document.getElementById('materials-table-body');
            
            materials.forEach((material, index) => {
                const isCompleted = material.have >= material.total;
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700 transition duration-150 ease-in-out';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-200">
                        ${material.item}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">
                        ${material.total}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <input
                            type="number"
                            value="${material.have}"
                            min="0"
                            class="w-24 p-2 rounded-md bg-gray-900 border text-white ${isCompleted ? 'border-green-500' : 'border-gray-600'} focus:outline-none focus:ring-2 focus:ring-teal-500 transition duration-150"
                            data-index="${index}"
                        />
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold">
                        ${isCompleted ? '<span class="text-green-400">✅ Fini !</span>' : '<span class="text-yellow-400">En cours...</span>'}
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Gérer les changements d'input
            tableBody.querySelectorAll('input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const index = e.target.dataset.index;
                    materials[index].have = parseInt(e.target.value, 10);
                    renderMaterials(materials); // Re-render le tableau pour mettre à jour les statuts
                });
            });
        };

        // Gérer le changement de fichier
        document.getElementById('file-input').addEventListener('change', (event) => {
            const file = event.target.files[0];
            const errorMessage = document.getElementById('error-message');
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const content = e.target.result;
                    const parsedMaterials = parseMaterialList(content);
                    if (parsedMaterials.length > 0) {
                        renderMaterials(parsedMaterials);
                        errorMessage.classList.add('hidden');
                    } else {
                        renderMaterials([]);
                        errorMessage.classList.remove('hidden');
                    }
                };
                reader.readAsText(file, 'UTF-8');
            }
        });

        // Gérer le bouton de réinitialisation
        document.getElementById('reset-button').addEventListener('click', () => {
            const materials = parseMaterialList(sampleMaterialList);
            renderMaterials(materials);
            document.getElementById('error-message').classList.add('hidden');
            document.getElementById('file-input').value = '';
        });

        // Initialiser l'application avec la liste d'exemple
        window.onload = () => {
            const materials = parseMaterialList(sampleMaterialList);
            renderMaterials(materials);
        };
    </script>
</body>
</html>
